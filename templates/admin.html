<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>لوحة التحكم</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; background: #fff; direction: rtl; }
    h1 { color: #4caf50; text-align: center; }
    form { display: flex; flex-direction: column; gap: 0.5rem; max-width: 500px; margin: auto; }
    input, textarea, button { padding: 0.7rem; font-size: 1rem; border-radius: 6px; border: 1px solid #ccc; }
    button { background: #4caf50; color: white; border: none; cursor: pointer; }
    table { width: 100%; margin-top: 2rem; border-collapse: collapse; }
    th, td { padding: 0.5rem; border: 1px solid #ccc; text-align: center; }
    img { width: 60px; }
  </style>
</head>
<body>
  <h1>لوحة التحكم</h1>

  <form id="productForm">
    <input type="hidden" name="id" />
    <input name="name" placeholder="اسم المنتج" required />
    <textarea name="description" placeholder="الوصف" required></textarea>
    <input name="price" placeholder="السعر" required />
    <input name="image" placeholder="رابط الصورة" required />
    <button type="submit">حفظ المنتج</button>
  </form>

  <table id="productsTable">
    <thead>
      <tr><th>صورة</th><th>الاسم</th><th>الوصف</th><th>السعر</th><th>العمليات</th></tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    const form = document.getElementById('productForm');
    const tbody = document.querySelector('#productsTable tbody');

    function loadProducts() {
      fetch('/api/products').then(res => res.json()).then(data => {
        tbody.innerHTML = '';
        data.forEach(p => {
          const row = document.createElement('tr');
          row.innerHTML = `
            <td><img src="${p.image}" /></td>
            <td>${p.name}</td>
            <td>${p.description}</td>
            <td>${p.price}</td>
            <td>
              <button onclick='edit(${JSON.stringify(p)})'>✏️</button>
              <button onclick='deleteProduct("${p._id}")'>🗑️</button>
            </td>`;
          tbody.appendChild(row);
        });
      });
    }

    function edit(p) {
      form.id.value = p._id;
      form.name.value = p.name;
      form.description.value = p.description;
      form.price.value = p.price;
      form.image.value = p.image;
    }

    form.onsubmit = e => {
      e.preventDefault();
      const data = Object.fromEntries(new FormData(form));
      const method = data.id ? 'PUT' : 'POST';
      const url = data.id ? `/update/${data.id}` : '/add';

      fetch(url, {
        method,
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
      }).then(() => {
        form.reset();
        loadProducts();
      });
    };

    function deleteProduct(id) {
      fetch('/delete/' + id, { method: 'DELETE' })
        .then(() => loadProducts());
    }

    loadProducts();
  </script>
</body>
</html>

